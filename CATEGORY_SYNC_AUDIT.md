# –ê–£–î–ò–¢: –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º WebApp

**–î–∞—Ç–∞:** 2024-12-20  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω

---

## üìã –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ, –Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º/–¥—É–±–ª–∏—Ä—É—é—â–µ–º WebApp.

**–ü—Ä–∏—á–∏–Ω–∞:** ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: id=3 vs id=9, id=30 vs id=31), –∏ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

**–¢–æ—á–∫–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:** Frontend-–ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `category_id` —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ `selectedCategoryIds` —Å–æ–¥–µ—Ä–∂–∏—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞.

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### 1Ô∏è‚É£ Backend-—É—Ä–æ–≤–µ–Ω—å: –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### 1.1. –≠–Ω–¥–ø–æ–∏–Ω—Ç GET /api/categories/

**–§–∞–π–ª:** `backend/app/routers/categories.py`, —Å—Ç—Ä–æ–∫–∏ 233-279

```python
@router.get("/", response_model=List[schemas.Category])
def get_categories(
    user_id: int,
    bot_id: Optional[int] = Query(None, description="ID –±–æ—Ç–∞ –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤"),
    flat: bool = Query(False, description="–í–µ—Ä–Ω—É—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ø–ª–æ—Å–∫–æ–º –≤–∏–¥–µ"),
    db: Session = Depends(database.get_db)
):
    query = db.query(models.Category).filter(models.Category.user_id == user_id)
    
    # –ï—Å–ª–∏ bot_id —É–∫–∞–∑–∞–Ω - —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ bot_id (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–∞–≥–∞–∑–∏–Ω –±–æ—Ç–∞)
    # –ï—Å–ª–∏ bot_id –Ω–µ —É–∫–∞–∑–∞–Ω - —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ bot_id = None (–æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç)
    if bot_id is not None:
        query = query.filter(models.Category.bot_id == bot_id)
    else:
        query = query.filter(models.Category.bot_id == None)
    
    categories = query.all()
    # ... –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
```

**–í—ã–≤–æ–¥:**
- ‚úÖ Backend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ `bot_id`
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –±–æ—Ç–∞–º (–æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç: `bot_id = None`, –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –±–æ—Ç: `bot_id = 2`)
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û:** –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏, –Ω–æ –∏–º–µ—é—Ç **–†–ê–ó–ù–´–ï ID** –≤ –∫–∞–∂–¥–æ–º –±–æ—Ç–µ

**–ü—Ä–∏–º–µ—Ä:**
- –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç: –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" –∏–º–µ–µ—Ç `id=3`, `bot_id=None`, `user_id=123`
- –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –±–æ—Ç: —Ç–∞ –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" –∏–º–µ–µ—Ç `id=9`, `bot_id=2`, `user_id=123`

#### 1.2. –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–§–∞–π–ª:** `backend/app/routers/categories.py`, —Ñ—É–Ω–∫—Ü–∏—è `sync_category_to_all_bots()`

**–í—ã–≤–æ–¥:**
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–æ **–∏–º–µ–Ω–∏** (`name`), –∞ –Ω–µ –ø–æ ID
- ‚úÖ –ö–∞–∂–¥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `id` –≤ –∫–∞–∂–¥–æ–º –±–æ—Ç–µ
- ‚úÖ –≠—Ç–æ **–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –±–æ—Ç–∞–º

---

### 2Ô∏è‚É£ Backend-—É—Ä–æ–≤–µ–Ω—å: –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

#### 2.1. –≠–Ω–¥–ø–æ–∏–Ω—Ç GET /api/context

**–§–∞–π–ª:** `backend/app/routers/context.py`, —Å—Ç—Ä–æ–∫–∏ 151-346

**–õ–æ–≥–∏–∫–∞:**
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç `bot_id` –∏–∑ `initData` (Telegram WebApp)
2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `bot_id` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ:
   - –û—Å–Ω–æ–≤–Ω–æ–π WebApp: `bot_id = None`
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π WebApp: `bot_id = ID –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2`)

**–í—ã–≤–æ–¥:**
- ‚úÖ Backend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `bot_id` –∏–∑ `initData`
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `bot_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ WebApp

---

### 3Ô∏è‚É£ Frontend-—É—Ä–æ–≤–µ–Ω—å: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### 3.1. –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `webapp/js/data.js`, —Å—Ç—Ä–æ–∫–∏ 50-72

```javascript
// –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ (shop_owner_id)
let botId = null;
if (appContext.bot_id !== undefined && appContext.bot_id !== null) {
    botId = appContext.bot_id;
}
const categories = await fetchCategories(appContext.shop_owner_id, botId, false);
renderCategories(categories);
```

**–í—ã–≤–æ–¥:**
- ‚úÖ Frontend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bot_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –í –æ—Å–Ω–æ–≤–Ω–æ–º WebApp: `botId = null` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å `bot_id = None` (ID: 3, 30, ...)
- ‚úÖ –í –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º WebApp: `botId = 2` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å `bot_id = 2` (ID: 9, 31, ...)

#### 3.2. –§—É–Ω–∫—Ü–∏—è fetchCategories

**–§–∞–π–ª:** `webapp/js/api/categories.js`

```javascript
export async function fetchCategories(shopOwnerId, botId = null, flat = false) {
    let url = `${API_BASE}/api/categories/?user_id=${shopOwnerId}`;
    if (botId !== null && botId !== undefined) {
        url += `&bot_id=${botId}`;
    }
    // ... –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ backend
}
```

**–í—ã–≤–æ–¥:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç `bot_id` –≤ –∑–∞–ø—Ä–æ—Å

---

### 4Ô∏è‚É£ Frontend-—É—Ä–æ–≤–µ–Ω—å: –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

#### 4.1. –§—É–Ω–∫—Ü–∏—è applyFilters

**–§–∞–π–ª:** `webapp/js/filters.js`, —Å—Ç—Ä–æ–∫–∏ 170-215

```javascript
export function applyFilters() {
    const selectedCategoryIds = selectedCategoryIdsGetter ? selectedCategoryIdsGetter() : new Set();
    const selectedMainCategoryId = selectedMainCategoryIdGetter ? selectedMainCategoryIdGetter() : null;
    const categoriesHierarchy = categoriesHierarchyGetter ? categoriesHierarchyGetter() : [];
    
    let filteredProducts = [...allProducts];
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    if (selectedCategoryIds.size > 0) {
        filteredProducts = filteredProducts.filter(prod => {
            return selectedCategoryIds.has(prod.category_id);  // ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê –ó–î–ï–°–¨
        });
    } else if (selectedMainCategoryId !== null) {
        const selectedMainCategory = categoriesHierarchy.find(cat => cat.id === selectedMainCategoryId);
        if (selectedMainCategory && selectedMainCategory.subcategories) {
            const subcategoryIds = new Set(selectedMainCategory.subcategories.map(sub => sub.id));
            filteredProducts = filteredProducts.filter(prod => {
                return subcategoryIds.has(prod.category_id);  // ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê –ó–î–ï–°–¨
            });
        }
    }
}
```

**–ü–†–û–ë–õ–ï–ú–ê:**
- `selectedCategoryIds` —Å–æ–¥–µ—Ä–∂–∏—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ **—Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, [9, 31] –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞)
- `allProducts` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–≤–∞—Ä—ã —Å `category_id` –∏–∑ **—Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞**
- ‚ö†Ô∏è **–ù–û:** –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–Ω—å—à–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –æ–Ω–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å `category_id` –∏–∑ **–¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `category_id=3` –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞)
- –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ `selectedCategoryIds.has(prod.category_id)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`, –µ—Å–ª–∏ `prod.category_id` –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞

---

### 5Ô∏è‚É£ –¢–æ—á–∫–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–¢–û–ß–ö–ê –†–ê–°–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò:** `webapp/js/filters.js`, —Ñ—É–Ω–∫—Ü–∏—è `applyFilters()`, —Å—Ç—Ä–æ–∫–∏ 190-215

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å `category_id` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å `id` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
3. **–ù–û:** –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–Ω—å—à–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∏–ª–∏ –µ—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Ç–æ–≤–∞—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å `category_id` –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞
4. –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ `selectedCategoryIds.has(prod.category_id)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`, –µ—Å–ª–∏ `category_id` —Ç–æ–≤–∞—Ä–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞

**–ü—Ä–∏–º–µ—Ä:**
- –í –æ—Å–Ω–æ–≤–Ω–æ–º WebApp: –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" –∏–º–µ–µ—Ç `id=3`
- –í –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º WebApp: –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" –∏–º–µ–µ—Ç `id=9`
- –¢–æ–≤–∞—Ä –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º WebApp –º–æ–∂–µ—Ç –∏–º–µ—Ç—å `category_id=3` (–∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞)
- –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º WebApp:
  - `selectedCategoryIds = [9]` (ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º –±–æ—Ç–µ)
  - `prod.category_id = 3` (ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ)
  - `selectedCategoryIds.has(3)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`
  - –¢–æ–≤–∞—Ä –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ‚ùå

---

## üîé –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –ü–æ—á–µ–º—É –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –ù–ï –≤—Å–µ–≥–¥–∞?

1. **–ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - –¢–æ–≤–∞—Ä—ã –∏–º–µ—é—Ç `category_id` –∏–∑ —Ç–æ–≥–æ –∂–µ –±–æ—Ç–∞, —á—Ç–æ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–Ω—å—à–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:**
   - –¢–æ–≤–∞—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å `category_id` –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. **–ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:**
   - –¢–æ–≤–∞—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å `category_id` –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ü–æ—á–µ–º—É –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç WebApp-–∏–Ω—Å—Ç–∞–Ω—Å–∞?

- **–û—Å–Ω–æ–≤–Ω–æ–π WebApp:** `bot_id = None` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å `bot_id = None` (ID: 3, 30, ...)
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π WebApp:** `bot_id = 2` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å `bot_id = 2` (ID: 9, 31, ...)
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º –±–æ—Ç–µ –∏–º–µ—é—Ç `category_id` –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## ‚úÖ –í–´–í–û–î–´

### 1. Backend –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `bot_id`
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `bot_id` –∏–∑ `initData`
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ —Å–æ–∑–¥–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ ID –≤ —Ä–∞–∑–Ω—ã—Ö –±–æ—Ç–∞—Ö)

### 2. Frontend –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º `bot_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –¢–æ–≤–∞—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º `bot_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### 3. –¢–æ—á–∫–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: Frontend —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

- ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç, —á—Ç–æ `category_id` —Ç–æ–≤–∞—Ä–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞
- ‚ö†Ô∏è **–ü–†–ò–ß–ò–ù–ê:** –¢–æ–≤–∞—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å `category_id` –∏–∑ –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞, –µ—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏–ª–∏ —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–Ω—å—à–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è category_id —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞

**–ú–µ—Å—Ç–æ:** `webapp/js/filters.js`, —Ñ—É–Ω–∫—Ü–∏—è `applyFilters()`

**–ò–¥–µ—è:** –ü–µ—Ä–µ–¥ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `category_id` —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞. –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –ª–æ–≥–∏–∫—É.

**–ü–ª—é—Å—ã:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–µ –ª–æ–º–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–ú–∏–Ω—É—Å—ã:**
- –¢–æ–≤–∞—Ä—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `category_id` –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
- –≠—Ç–æ —Å–∏–º–ø—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –∞ –Ω–µ –∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ò–¥–µ—è:** –í–º–µ—Å—Ç–æ `category_id` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `category.name` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.

**–ü–ª—é—Å—ã:**
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- –ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤ (backend)

**–§–∞–π–ª:** `backend/app/utils/products_sync.py` (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) –∏–ª–∏ `backend/app/routers/categories.py`

**–ò–¥–µ—è:** –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `category_id` —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Ü–µ–ª–µ–≤–æ–º –±–æ—Ç–µ. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –Ω–∞–π—Ç–∏ –µ–µ –ø–æ –∏–º–µ–Ω–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `category_id`.

**–ü–ª—é—Å—ã:**
- –†–µ—à–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ frontend

**–ú–∏–Ω—É—Å—ã:**
- –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ backend
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤

---

## üìä –°–¢–ê–¢–£–° –ê–ù–ê–õ–ò–ó–ê

- ‚úÖ Backend –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ Backend –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ Frontend –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ Frontend –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –¢–æ—á–∫–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ - –Ω–∞–π–¥–µ–Ω–∞
- ‚úÖ –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ - —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã

---

## üìù –ó–ê–ú–ï–¢–ö–ò

1. **–î–æ–∫—É–º–µ–Ω—Ç CATEGORY_SYNC_FIX.md** –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Ö–æ–∂—É—é –ø—Ä–æ–±–ª–µ–º—É, –Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏. –≠—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å–≤—è–∑–∞–Ω–∞, –Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤ WebApp.

2. **–°–∫—Ä–∏–ø—Ç fix_category_sync.py** –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.

3. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ backend, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
